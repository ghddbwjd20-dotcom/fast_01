# 대화형 경제 분석 코파일럿 - 기능 가이드

## 🤖 핵심 컨셉

**"대화가 곧 제품"** - 챗봇이 모든 기능의 중심입니다.

사용자는 자연어로 질문/요청만 하면, AI가:
- 데이터를 조회하고
- 차트와 표를 생성하고
- 계산을 수행하고
- 분석과 인사이트를 제공합니다

---

## 🛠️ AI가 사용하는 6가지 툴

### 1. **get_series** - 데이터 조회
경제 지표 시계열 데이터를 가져옵니다.

**예시 질문:**
- "2019년부터 지금까지 CPI 데이터 보여줘"
- "최근 3년간 기준금리와 실업률 추이"

**사용 가능한 지표:**
- CPI_YOY (소비자물가지수)
- CORE_CPI_YOY (근원 CPI)
- POLICY_RATE (기준금리)
- UNEMPLOYMENT (실업률)
- GDP_YOY (GDP 성장률)
- USD_KRW (원달러 환율)

### 2. **make_chart** - 차트 생성
데이터를 시각화합니다.

**예시 질문:**
- "CPI와 금리를 라인 차트로 그려줘"
- "최근 2년 실업률을 영역 차트로"
- "금리와 실업률을 2축 차트로 비교해줘"

**차트 타입:**
- line (라인)
- area (영역)
- bar (막대)
- combo (복합 - 2축)

### 3. **calc_whatif** - What-if 계산
경제 시나리오를 계산합니다.

**예시 질문:**
- "금리가 25bp 인상되면?"
- "10년물과 3년물 국채 스프레드는 얼마야?"
- "금리 0.5% 오르면 주택담보대출 금리는?"

**계산 가능:**
- spread (금리 스프레드)
- rate_change_impact (금리 변화 영향)
- 기타 경제 계산

### 4. **get_calendar** - 경제 일정
발표 일정을 조회합니다.

**예시 질문:**
- "이번 주 주요 경제 발표 일정 알려줘"
- "다음 주 CPI 발표는 언제야?"
- "다가오는 금통위 일정"

### 5. **save_bookmark** - 북마크
차트나 분석을 저장합니다.

**예시 질문:**
- "이 차트 북마크에 저장해줘"
- "이 분석을 '금리 분석'이라는 이름으로 저장"

### 6. **render_report** - 리포트 생성
위젯들을 PDF 리포트로 만듭니다.

**예시 질문:**
- "지금까지 생성한 차트들로 PDF 만들어줘"
- "이번 주 거시 브리핑 리포트 생성"

---

## 💬 10가지 주요 사용 사례

### 1️⃣ 자연어 → 차트 생성
```
질문: "2018년부터 현재까지 CPI와 기준금리 라인그래프 보여줘"

AI:
- get_series(["CPI_YOY", "POLICY_RATE"], start="2018-01-01")
- make_chart({type: "line", series: ["CPI_YOY", "POLICY_RATE"]})
→ 차트 위젯 생성
```

### 2️⃣ 자연어 → 표 생성
```
질문: "최근 12개월 무역수지 표로 정리해줘"

AI:
- get_series(["TRADE_BALANCE"], start="최근 12개월")
- 표 위젯으로 변환
```

### 3️⃣ 시나리오 브리핑
```
질문: "CPI가 3% 고착되면 3개월 전망: 낙관/기준/비관 3가지"

AI:
- 과거 데이터 분석
- 3가지 시나리오 생성
- 각 시나리오별 영향 설명
```

### 4️⃣ 이벤트 캘린더 & 알림
```
질문: "다음 FOMC 발표 일정 알려줘"

AI:
- get_calendar() 호출
- 관련 일정 필터링
- 카드로 표시
```

### 5️⃣ What-if 계산기
```
질문: "금리 +25bp면 10Y-3Y 스프레드는?"

AI:
- calc_whatif(formula="spread", inputs={...})
- 결정적 계산 수행
- 결과 해석 제공
```

### 6️⃣ 용어 튜터
```
질문: "코어 CPI가 뭐야? 초보자 버전으로"

AI:
- 내장 지식 기반 설명
- 정의 + 중요성 + 시장 반응
- 현재 값 및 해석 팁
```

### 7️⃣ 리포트 생성
```
질문: "이번 주 거시 브리핑 PDF로 만들어줘 (차트 2개 포함)"

AI:
- 주요 지표 요약
- 차트 2개 생성
- render_report() 호출
→ PDF 다운로드 링크 제공
```

### 8️⃣ 데이터 출처 근거 표기
모든 응답에 자동으로 출처가 표기됩니다:
- 통계청, 한국은행, KOSIS 등
- 업데이트 날짜
- 데이터 소스 URL

### 9️⃣ 컬렉션/즐겨찾기 관리
```
질문: "방금 만든 차트 북마크에 저장해줘"

AI:
- save_bookmark(title="CPI vs 금리", widget_id="...")
→ MongoDB에 저장
```

### 🔟 자동 브리핑
매일 아침 자동 생성:
- 야간 시장 요약
- 오늘의 주요 일정
- 핵심 차트 2개
- 주목할 지표 3개

---

## 🎯 샘플 프롬프트

### 데이터 조회 & 차트
```
"2019~지금까지 CPI와 금리 비교 차트 보여줘"
"최근 5년 무역수지 추이를 영역 차트로"
"금리와 실업률을 2축 차트로 그려줘 (2010년부터)"
```

### 계산 & What-if
```
"금리 25bp 인상 시 10년물 국채 수익률은?"
"10Y-3Y 스프레드 계산해줘"
"환율이 1,400원 되면 수출 기업 영향은?"
```

### 설명 & 학습
```
"코어 CPI가 뭐야? 쉽게 설명해줘"
"GDP 기여도가 뭔지 알려줘"
"실업률이 왜 중요한지 설명"
```

### 일정 & 알림
```
"이번 주 주요 발표 일정 알려줘"
"다음 CPI 발표는 언제야?"
"금통위 회의 일정 확인"
```

### 종합 분석
```
"이번 달 경제 핵심 3줄로 요약해줘"
"최근 물가 상승 원인 분석"
"다음 분기 금리 전망 3가지 시나리오"
```

---

## 🎨 UI 구성

### 메인 화면 (/)
```
┌─────────────────────────────────────────┐
│  AI 경제 분석 코파일럿                      │
├─────────────────┬───────────────────────┤
│   대화 영역       │   위젯 영역              │
│   (왼쪽)         │   (오른쪽)               │
│                 │                       │
│ - 사용자 질문     │ - 생성된 차트            │
│ - AI 응답       │ - 표                    │
│ - 후속 질문 제안 │ - 카드                  │
│                 │                       │
│ [입력창]         │ [북마크/리포트 버튼]     │
└─────────────────┴───────────────────────┘
```

### 위젯 타입

**차트 위젯:**
- 라인, 영역, 막대, 복합 차트
- 2축 지원
- 주석 (목표선, 이벤트 마커)
- 출처 표기

**표 위젯:**
- 동적 컬럼
- 정렬 가능
- 서프라이즈 하이라이트

**카드 위젯:**
- 마크다운 렌더링
- 4가지 variant (default, success, warning, error)
- 요약, 인사이트, 알림 등

---

## 🔐 안전장치

### 1. 입력 검증
- 최대 길이 제한
- 프롬프트 인젝션 방지
- Pydantic 검증

### 2. 출처 강제 표기
모든 위젯에 출처와 업데이트 시간이 표시됩니다.

### 3. 면책 문구
투자/재무 관련 답변에는 자동으로 면책 문구가 추가됩니다:
> "이 정보는 교육 및 정보 제공 목적입니다. 투자 결정 시 전문가와 상담하세요."

### 4. 토큰 & 비용 추적
모든 AI 호출이 로그에 기록됩니다:
- 사용 토큰 수
- 툴 호출 내역
- 응답 시간

---

## 📊 데이터 소스

### 현재 (Mock)
- JSON 기반 샘플 데이터
- 구조만 확정된 상태

### 향후 연동 가능
- **국내**: ECOS (한국은행), KOSIS (통계청)
- **글로벌**: FRED, OECD, IMF, World Bank
- **시장**: KRX, Yahoo Finance

---

## 💾 MongoDB 컬렉션

```
sessions        - 대화 세션
widgets         - 생성된 위젯
series_cache    - 시계열 캐시
bookmarks       - 사용자 북마크
reports         - 생성된 리포트
ai_logs         - AI 호출 로그
calendar        - 경제 일정
```

---

## 🚀 사용 흐름

1. **메인 페이지 접속** (http://localhost:5173)
2. **질문 입력** 또는 **샘플 프롬프트 클릭**
3. **AI가 자동으로:**
   - 필요한 데이터 조회
   - 차트/표 생성
   - 분석 제공
4. **생성된 위젯**이 오른쪽에 표시됨
5. **후속 질문** 클릭하거나 새로운 질문 입력
6. **북마크/리포트** 버튼으로 저장

---

## 🎯 핵심 장점

1. **자연어 인터페이스** - 복잡한 메뉴 없이 대화만으로
2. **동적 시각화** - 요청에 맞춰 실시간 차트 생성
3. **출처 투명성** - 모든 데이터에 출처 표기
4. **맥락 유지** - 세션 기반 대화 기록
5. **학습 친화적** - 초보자도 쉽게 이해

---

## 📝 예시 대화

```
사용자: "2019년부터 지금까지 CPI와 기준금리 비교해줘"

AI: [get_series 호출]
    [make_chart 호출]
    
    CPI와 기준금리 추이를 비교했습니다. 2019년 이후:
    - CPI는 2.0% → 2.3%로 상승
    - 기준금리는 1.25% → 3.50%로 인상
    
    [차트 위젯 생성]
    
    출처: 통계청, 한국은행
    
    후속 질문:
    - "코어 CPI로 바꿔볼까?"
    - "최근 1년만 확대해줘"
    - "이 차트 북마크에 저장해줘"
```

---

## 🔧 설정

### OpenAI API 키 (필수)
`backend/.env` 파일:
```
OPENAI_API_KEY=sk-your-real-key-here
```

### MongoDB (선택)
없어도 작동하지만, 북마크/세션 저장은 불가능합니다.

---

## 🎓 사용 팁

1. **구체적으로 질문하기**
   - ❌ "경제 보여줘"
   - ✅ "최근 3년 CPI 추이 차트로 보여줘"

2. **기간 명시하기**
   - "2019년부터", "최근 12개월", "3년간"

3. **차트 타입 지정하기**
   - "라인 차트", "영역 차트", "2축 차트"

4. **후속 질문 활용하기**
   - AI가 제안하는 후속 질문 클릭

5. **북마크 활용하기**
   - 자주 보는 차트는 저장해두기

---

현재 상태: ✅ 완전 작동 (Mock 데이터)
다음 단계: 실제 API 연동

